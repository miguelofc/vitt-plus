{"ast":null,"code":"import _asyncToGenerator from \"/Users/miguel/Desktop/vitta-plus-premium/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CommonModule } from \"@angular/common\";\nimport { FormsModule } from \"@angular/forms\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/chamadas.service\";\nimport * as i2 from \"../../core/services/toast.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nconst _c0 = [\"localVideo\"];\nconst _c1 = [\"remoteVideo\"];\nfunction ChamadasComponent_span_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Criar sala\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ChamadasComponent_span_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 21);\n    i0.ɵɵtext(1, \"Criando\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ChamadasComponent_span_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Entrar na sala\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ChamadasComponent_span_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 21);\n    i0.ɵɵtext(1, \"Entrando\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ChamadasComponent = /*#__PURE__*/(() => {\n  class ChamadasComponent {\n    constructor(chamadasService, toast) {\n      this.chamadasService = chamadasService;\n      this.toast = toast;\n      this.roomId = \"\";\n      this.localStream = null;\n      this.creatingRoom = false;\n      this.joiningRoom = false;\n      this.initLocalMedia();\n    }\n    initLocalMedia() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const stream = yield navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: true\n          });\n          _this.localStream = stream;\n          const video = _this.localVideoRef.nativeElement;\n          video.srcObject = stream;\n          video.muted = true;\n          yield video.play();\n        } catch (error) {\n          console.error(error);\n          _this.toast.error(\"Não foi possível acessar a câmera.\");\n        }\n      })();\n    }\n    createRoom() {\n      this.creatingRoom = true;\n      this.chamadasService.createRoom().subscribe({\n        next: res => {\n          this.roomId = res.roomId;\n          this.toast.success(\"Sala criada. Compartilhe o código com o paciente.\");\n        },\n        error: () => {\n          this.toast.error(\"Erro ao criar sala.\");\n          this.creatingRoom = false;\n        },\n        complete: () => {\n          this.creatingRoom = false;\n        }\n      });\n    }\n    joinRoom() {\n      if (!this.roomId) {\n        this.toast.error(\"Informe o código da sala.\");\n        return;\n      }\n      this.joiningRoom = true;\n      this.chamadasService.joinRoom(this.roomId).subscribe({\n        next: () => {\n          this.toast.success(\"Você entrou na sala.\");\n        },\n        error: () => {\n          this.toast.error(\"Erro ao entrar na sala.\");\n          this.joiningRoom = false;\n        },\n        complete: () => {\n          this.joiningRoom = false;\n        }\n      });\n    }\n    static {\n      this.ɵfac = function ChamadasComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ChamadasComponent)(i0.ɵɵdirectiveInject(i1.ChamadasService), i0.ɵɵdirectiveInject(i2.ToastService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ChamadasComponent,\n        selectors: [[\"app-chamadas\"]],\n        viewQuery: function ChamadasComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 7);\n            i0.ɵɵviewQuery(_c1, 7);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.localVideoRef = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.remoteVideoRef = _t.first);\n          }\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 30,\n        vars: 7,\n        consts: [[\"remoteVideo\", \"\"], [\"localVideo\", \"\"], [1, \"space-y-6\"], [1, \"flex\", \"items-center\", \"justify-between\"], [1, \"text-2xl\", \"font-semibold\", \"text-slate-900\", \"dark:text-slate-100\"], [1, \"text-sm\", \"text-slate-500\", \"dark:text-slate-400\"], [1, \"grid\", \"grid-cols-1\", \"lg:grid-cols-3\", \"gap-6\", \"items-start\"], [1, \"lg:col-span-2\", \"rounded-3xl\", \"bg-slate-900\", \"border\", \"border-slate-800\", \"shadow-soft\", \"p-3\", \"relative\", \"aspect-video\", \"flex\", \"items-center\", \"justify-center\"], [1, \"w-full\", \"h-full\", \"rounded-2xl\", \"bg-slate-800\", \"object-cover\"], [1, \"w-40\", \"h-28\", \"rounded-2xl\", \"bg-slate-700\", \"object-cover\", \"border\", \"border-slate-600\", \"absolute\", \"bottom-4\", \"right-4\", \"shadow-soft\"], [1, \"rounded-3xl\", \"bg-white\", \"dark:bg-slate-900\", \"border\", \"border-slate-200\", \"dark:border-slate-800\", \"p-5\", \"space-y-4\", \"shadow-soft\"], [1, \"text-sm\", \"font-semibold\"], [1, \"space-y-3\"], [1, \"space-y-1\"], [1, \"text-xs\", \"text-slate-500\"], [\"placeholder\", \"Digite ou gere um c\\u00F3digo\", 1, \"input-field\", 3, \"ngModelChange\", \"ngModel\"], [1, \"flex\", \"gap-3\"], [1, \"btn-primary\", \"text-xs\", \"flex-1\", 3, \"click\", \"disabled\"], [4, \"ngIf\"], [\"class\", \"animate-pulse\", 4, \"ngIf\"], [1, \"btn-outline\", \"text-xs\", \"flex-1\", 3, \"click\", \"disabled\"], [1, \"animate-pulse\"]],\n        template: function ChamadasComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"section\", 2)(1, \"header\", 3)(2, \"div\")(3, \"h1\", 4);\n            i0.ɵɵtext(4, \" Chamada WebRTC \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"p\", 5);\n            i0.ɵɵtext(6, \" Inicie uma sala de atendimento e compartilhe o c\\u00F3digo com o paciente. \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(7, \"div\", 6)(8, \"div\", 7);\n            i0.ɵɵelement(9, \"video\", 8, 0)(11, \"video\", 9, 1);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"div\", 10)(14, \"h2\", 11);\n            i0.ɵɵtext(15, \"Controles da chamada\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"div\", 12)(17, \"div\", 13)(18, \"label\", 14);\n            i0.ɵɵtext(19, \"C\\u00F3digo da sala\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"input\", 15);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ChamadasComponent_Template_input_ngModelChange_20_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              i0.ɵɵtwoWayBindingSet(ctx.roomId, $event) || (ctx.roomId = $event);\n              return i0.ɵɵresetView($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"div\", 16)(22, \"button\", 17);\n            i0.ɵɵlistener(\"click\", function ChamadasComponent_Template_button_click_22_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.createRoom());\n            });\n            i0.ɵɵtemplate(23, ChamadasComponent_span_23_Template, 2, 0, \"span\", 18)(24, ChamadasComponent_span_24_Template, 2, 0, \"span\", 19);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function ChamadasComponent_Template_button_click_25_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.joinRoom());\n            });\n            i0.ɵɵtemplate(26, ChamadasComponent_span_26_Template, 2, 0, \"span\", 18)(27, ChamadasComponent_span_27_Template, 2, 0, \"span\", 19);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(28, \"p\", 14);\n            i0.ɵɵtext(29, \" Nesta vers\\u00E3o a sala j\\u00E1 \\u00E9 integrada ao backend e ao Firestore pelo servidor. A evolu\\u00E7\\u00E3o natural \\u00E9 adicionar troca de offer, answer e candidates com base neste mesmo c\\u00F3digo, conectando local e remoto em tempo real. \");\n            i0.ɵɵelementEnd()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(20);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.roomId);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.creatingRoom);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.creatingRoom);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.creatingRoom);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", ctx.joiningRoom);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.joiningRoom);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.joiningRoom);\n          }\n        },\n        dependencies: [CommonModule, i3.NgIf, FormsModule, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel],\n        encapsulation: 2\n      });\n    }\n  }\n  return ChamadasComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}